{
  "hash": "ea15702c1e1ef7332dcd7d0a68575582",
  "result": {
    "markdown": "---\ntitle: \"Data_Visualization CH7\"\nauthor: \"Seongtaek\"\ndate: \"2023-04-13\"\ncategories: [code, data_visualization, rstudio]\nimage: \"ch7.png\"\ntoc: true\ntoc-depth: 4\nnumber-sections: true\n---\n\n\n<table align=\"bottom\">\n  <td>\n    <a target=\"_blank\" href=\"figure-4.4-,--figure-4.6.html\"><img\n    src = r_logo.png />HTML파일로 보기</a>\n  </td>\n</table>\n\nFigure 4.2, Figure 4.8\n\n\n\n\n\n## 데이터 시각화 실습 : 지역 정보 시각화 Figure 4.4, 4.6\n\n### 패키지 불러오기\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"geojsonsf\")\nlibrary(geojsonsf)\nlibrary(sf)\n#> Linking to GEOS 3.9.3, GDAL 3.5.2, PROJ 8.2.1; sf_use_s2() is TRUE\nlibrary(ggplot2)\nlibrary(dplyr)\n#> \n#> Attaching package: 'dplyr'\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\nlibrary(colorspace)\n```\n:::\n\n\n### 데이터 불러오기\n- KOR_SIDO.json : 대한민국 시,도 정보\n- KOR_SIGU.json : 대한민국 시,군,구 정보\n- 202202_주민등록인구및세대현황.csv\n\n\n::: {.cell}\n\n```{.r .cell-code}\nKOR_SIDO <- geojson_sf('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/KOR_SIDO.json')\n\nKOR_SIGU <- geojson_sf('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/KOR_SIGU.json')\n\nkor_202202 <- read.csv('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/202202_주민등록인구및세대현황.csv')\n```\n:::\n\n\n### 전처리\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### 컬럼 클래스(타입) 확인\nkor_202202 %>% sapply(class)\n#>      행정구역 행정구역_코드      총인구수        세대수   세대당_인구 \n#>   \"character\"     \"numeric\"     \"numeric\"     \"numeric\"     \"numeric\" \n#>   남자_인구수   여자_인구수     남여_비율 \n#>     \"numeric\"     \"numeric\"     \"numeric\"\n\n### `행정구역_코드`를 numeric → character형식으로 변환\nkor_202202$행정구역_코드 <- kor_202202$행정구역_코드 %>% format()\n\nuse_map <- KOR_SIGU\nuse_map %>% head()\n#> Simple feature collection with 6 features and 3 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 127.5071 ymin: 37.06363 xmax: 129.1596 ymax: 38.23041\n#> Geodetic CRS:  WGS 84\n#>   SIG_CD   SIG_ENG_NM SIG_KOR_NM                       geometry\n#> 1  42110 Chuncheon-si     춘천시 POLYGON ((127.6047 38.07265...\n#> 2  42130     Wonju-si     원주시 POLYGON ((128.1086 37.2988,...\n#> 3  42150 Gangneung-si     강릉시 POLYGON ((129.0479 37.64961...\n#> 4  42170   Donghae-si     동해시 POLYGON ((129.1596 37.47574...\n#> 5  42190   Taebaek-si     태백시 POLYGON ((129.0121 37.31012...\n#> 6  42210    Sokcho-si     속초시 POLYGON ((128.6087 38.16128...\n\n### 병합할 컬럼 동일화\nuse_map$행정구역_코드 <- paste(use_map$SIG_CD, \"00000\", sep = \"\")\n\n### 공통된 '행정구역_코드'를 기준으로 병합 \nuse_map <- use_map %>% merge(kor_202202, by = \"행정구역_코드\", all.x=T)\n```\n:::\n\n\n### Figure 4.4 - 총 인구수\n- 사용 데이터셋 : use_map\n- fill : 총인구수\n- geom_sf (지리적 객체 그래프)\n  - 경계선 색상\n- coord_sf\n  - 지도 좌표계 제거\n- scale_fill_distiller\n  - 이름 : \"인구수\"\n  - 팔레트 색상 설정\n  - 연속형 색상 척도 사용\n  - 결측값 색상 설정\n  - 색상 척도 방향 설정 : 작은 값 → 큰 값\n  - 색상 척도 눈금 설정\n  - 색상 척도 라벨 설정, 천 단위 옵션, 지수표기법 미사용\n- 테마 : 미니멀\n- 테마 옵션\n  - 범례 제목 위치 지정\n  - 범례 텍스트 위치 지정\n  - 범례 위치 지정\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(use_map, aes(fill = 총인구수)) +\ngeom_sf(color = \"gray90\") +\ncoord_sf(datum = NA) +\nscale_fill_distiller(name = \"인구수\",\n                      palette = \"Blues\",\n                      type = \"seq\",\n                      na.value = \"grey60\",\n                      direction = 1,\n                      breaks = seq(0,10,2) * 1e+5,\n                      labels = format(seq(0,10,2) * 1e+5,\n                                      big.mark = \",\", scientific = F),) +\ntheme_minimal() +\ntheme(legend.title.align = 0.5,\n      legend.text.align = 1.0,\n      legend.position = c(.85, .2))\n```\n\n::: {.cell-output-display}\n![](figure-4.4-,--figure-4.6_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### 광주만 뽑기\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### filter 이용 광주지역만 추출\nuse_map %>%\n  filter(substr(행정구역_코드,1,2) == \"29\") %>% \n  ggplot(aes(fill = 총인구수)) +\n  geom_sf(color = \"gray90\") +\n  coord_sf(datum = NA) +\n  scale_fill_distiller(name = \"인구수\",\n                       palette = \"Blues\",\n                       type = \"seq\",\n                       na.value = \"grey60\",\n                       direction = 1,\n                       breaks = seq(0,10,2) * 1e+5,\n                       labels = format(seq(0,10,2) * 1e+5,\n                                       big.mark = \",\", scientific = F),) +\n  theme_minimal() +\n  theme(legend.title.align = 0.5,\n        legend.text.align = 1.0,\n        legend.position = c(1, .2))\n```\n\n::: {.cell-output-display}\n![](figure-4.4-,--figure-4.6_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Figure 4.6 - 남여 비율\n- 사용 데이터셋 : use_map\n- fill : 남여_비율\n- geom_sf (지리적 객체 그래프)\n- coord_sf\n  - 지도 좌표계 제거\n- scale_fill_continuous_diverging\n  - 이름 : \"남자/여자\"\n  - 팔레트 색상 설정\n  - 색상 척도 : 중앙값 기준\n  - 색상 척도 범위 설정\n  - 색상 척도 순서 반전\n- 테마 : 미니멀\n- 테마 옵션\n  - 범례 제목 위치 지정\n  - 범례 텍스트 위치 지정\n  - 범례 위치 지정\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(use_map, aes(fill = 남여_비율)) +\ngeom_sf() +\ncoord_sf(datum = NA) +\nscale_fill_continuous_diverging(name = \"남자/여자\",\n                                palette = \"Blue-Red\",\n                                mid = 1,\n                                limits = 1 + c(-1, 1)*0.35,\n                                rev = T) +\ntheme_minimal() +\ntheme(legend.title.align = 0.5,\n      legend.text.align = 1.0,\n      legend.position = c(.95, .3))\n```\n\n::: {.cell-output-display}\n![](figure-4.4-,--figure-4.6_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## 과제\n- 2023년3월 총인구수 - Figure 4.4 \n\n### 데이터 불러오기\n- 202303_202303_주민등록인구및세대현황_월간.csv\n- KOR_SIGU.json : 대한민국 시,군,구 정보\n\n::: {.cell}\n\n```{.r .cell-code}\nkor_202303 <- read.csv('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/202303_202303_주민등록인구및세대현황_월간.csv',fileEncoding = \"CP949\")\nKOR_SIGU <- geojson_sf('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/KOR_SIGU.json')\n\nkor_202303 %>% head()\n#>                         행정구역 X2023년03월_총인구수 X2023년03월_세대수\n#> 1       서울특별시  (1100000000)            9,426,404          4,463,385\n#> 2 서울특별시 종로구 (1111000000)              141,060             72,679\n#> 3   서울특별시 중구 (1114000000)              120,963             63,862\n#> 4 서울특별시 용산구 (1117000000)              217,756            109,735\n#> 5 서울특별시 성동구 (1120000000)              280,240            133,513\n#> 6 서울특별시 광진구 (1121500000)              336,801            169,787\n#>   X2023년03월_세대당.인구 X2023년03월_남자.인구수 X2023년03월_여자.인구수\n#> 1                    2.11               4,566,299               4,860,105\n#> 2                    1.94                  68,170                  72,890\n#> 3                    1.89                  58,699                  62,264\n#> 4                    1.98                 104,640                 113,116\n#> 5                    2.10                 136,233                 144,007\n#> 6                    1.98                 162,209                 174,592\n#>   X2023년03월_남여.비율\n#> 1                  0.94\n#> 2                  0.94\n#> 3                  0.94\n#> 4                  0.93\n#> 5                  0.95\n#> 6                  0.93\n\nKOR_SIGU %>% head()\n#> Simple feature collection with 6 features and 3 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 127.5071 ymin: 37.06363 xmax: 129.1596 ymax: 38.23041\n#> Geodetic CRS:  WGS 84\n#>   SIG_CD   SIG_ENG_NM SIG_KOR_NM                       geometry\n#> 1  42110 Chuncheon-si     춘천시 POLYGON ((127.6047 38.07265...\n#> 2  42130     Wonju-si     원주시 POLYGON ((128.1086 37.2988,...\n#> 3  42150 Gangneung-si     강릉시 POLYGON ((129.0479 37.64961...\n#> 4  42170   Donghae-si     동해시 POLYGON ((129.1596 37.47574...\n#> 5  42190   Taebaek-si     태백시 POLYGON ((129.0121 37.31012...\n#> 6  42210    Sokcho-si     속초시 POLYGON ((128.6087 38.16128...\n```\n:::\n\n\n### 전처리\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"stringr\")\nlibrary(stringr) # 고급 문자 추출 패키지\n#> Warning: package 'stringr' was built under R version 4.2.2\n\n### 쉼표없는 총인구수 컬럼 생성\n### 행정구역 코드만 추출한 컬럼 생성\nkor_202303 <- kor_202303 %>% \n  mutate(총인구수_202303 = gsub(\",\",\"\", X2023년03월_총인구수),\n         행정구역_코드 = str_sub(kor_202303$행정구역, -11, -2))\n\n### 컬럼 클래스(타입) 확인\nkor_202303 %>% sapply(class)\n#>                행정구역    X2023년03월_총인구수      X2023년03월_세대수 \n#>             \"character\"             \"character\"             \"character\" \n#> X2023년03월_세대당.인구 X2023년03월_남자.인구수 X2023년03월_여자.인구수 \n#>               \"numeric\"             \"character\"             \"character\" \n#>   X2023년03월_남여.비율         총인구수_202303           행정구역_코드 \n#>               \"numeric\"             \"character\"             \"character\"\n\n### '총인구수_202303' 컬럼 character → numeric 변환\nkor_202303$총인구수_202303 <- kor_202303$총인구수_202303 %>% as.numeric()\n\n### 병합할 컬럼 동일화\nKOR_SIGU_use <- KOR_SIGU\nKOR_SIGU_use$행정구역_코드 <- paste(KOR_SIGU_use$SIG_CD, \"00000\", sep = \"\")\n\nkor_202303 %>% head()\n#>                         행정구역 X2023년03월_총인구수 X2023년03월_세대수\n#> 1       서울특별시  (1100000000)            9,426,404          4,463,385\n#> 2 서울특별시 종로구 (1111000000)              141,060             72,679\n#> 3   서울특별시 중구 (1114000000)              120,963             63,862\n#> 4 서울특별시 용산구 (1117000000)              217,756            109,735\n#> 5 서울특별시 성동구 (1120000000)              280,240            133,513\n#> 6 서울특별시 광진구 (1121500000)              336,801            169,787\n#>   X2023년03월_세대당.인구 X2023년03월_남자.인구수 X2023년03월_여자.인구수\n#> 1                    2.11               4,566,299               4,860,105\n#> 2                    1.94                  68,170                  72,890\n#> 3                    1.89                  58,699                  62,264\n#> 4                    1.98                 104,640                 113,116\n#> 5                    2.10                 136,233                 144,007\n#> 6                    1.98                 162,209                 174,592\n#>   X2023년03월_남여.비율 총인구수_202303 행정구역_코드\n#> 1                  0.94         9426404    1100000000\n#> 2                  0.94          141060    1111000000\n#> 3                  0.94          120963    1114000000\n#> 4                  0.93          217756    1117000000\n#> 5                  0.95          280240    1120000000\n#> 6                  0.93          336801    1121500000\nKOR_SIGU_use %>% head()\n#> Simple feature collection with 6 features and 4 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 127.5071 ymin: 37.06363 xmax: 129.1596 ymax: 38.23041\n#> Geodetic CRS:  WGS 84\n#>   SIG_CD   SIG_ENG_NM SIG_KOR_NM                       geometry 행정구역_코드\n#> 1  42110 Chuncheon-si     춘천시 POLYGON ((127.6047 38.07265...    4211000000\n#> 2  42130     Wonju-si     원주시 POLYGON ((128.1086 37.2988,...    4213000000\n#> 3  42150 Gangneung-si     강릉시 POLYGON ((129.0479 37.64961...    4215000000\n#> 4  42170   Donghae-si     동해시 POLYGON ((129.1596 37.47574...    4217000000\n#> 5  42190   Taebaek-si     태백시 POLYGON ((129.0121 37.31012...    4219000000\n#> 6  42210    Sokcho-si     속초시 POLYGON ((128.6087 38.16128...    4221000000\n\n### 공통된 '행정구역_코드'를 기준으로 병합 \nKOR_SIGU_use <- KOR_SIGU_use %>% merge(kor_202303, by = \"행정구역_코드\", all.x=T)\nKOR_SIGU_use %>% head()\n#> Simple feature collection with 6 features and 12 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 126.9446 ymin: 37.50654 xmax: 127.1153 ymax: 37.6317\n#> Geodetic CRS:  WGS 84\n#>   행정구역_코드 SIG_CD    SIG_ENG_NM SIG_KOR_NM\n#> 1    1111000000  11110     Jongno-gu     종로구\n#> 2    1114000000  11140       Jung-gu       중구\n#> 3    1117000000  11170    Yongsan-gu     용산구\n#> 4    1120000000  11200  Seongdong-gu     성동구\n#> 5    1121500000  11215   Gwangjin-gu     광진구\n#> 6    1123000000  11230 Dongdaemun-gu   동대문구\n#>                           행정구역 X2023년03월_총인구수 X2023년03월_세대수\n#> 1   서울특별시 종로구 (1111000000)              141,060             72,679\n#> 2     서울특별시 중구 (1114000000)              120,963             63,862\n#> 3   서울특별시 용산구 (1117000000)              217,756            109,735\n#> 4   서울특별시 성동구 (1120000000)              280,240            133,513\n#> 5   서울특별시 광진구 (1121500000)              336,801            169,787\n#> 6 서울특별시 동대문구 (1123000000)              337,574            171,140\n#>   X2023년03월_세대당.인구 X2023년03월_남자.인구수 X2023년03월_여자.인구수\n#> 1                    1.94                  68,170                  72,890\n#> 2                    1.89                  58,699                  62,264\n#> 3                    1.98                 104,640                 113,116\n#> 4                    2.10                 136,233                 144,007\n#> 5                    1.98                 162,209                 174,592\n#> 6                    1.97                 165,933                 171,641\n#>   X2023년03월_남여.비율 총인구수_202303                       geometry\n#> 1                  0.94          141060 POLYGON ((127.0118 37.58157...\n#> 2                  0.94          120963 POLYGON ((127.0234 37.57191...\n#> 3                  0.93          217756 POLYGON ((127.009 37.54413,...\n#> 4                  0.95          280240 POLYGON ((127.0724 37.55996...\n#> 5                  0.93          336801 POLYGON ((127.1153 37.55676...\n#> 6                  0.97          337574 POLYGON ((127.0711 37.60732...\n```\n:::\n\n\n### Figure 4.4 - 2023년3월 총인구수\n- 사용 데이터셋 : KOR_SIGU_use\n- fill : 총인구수_202303\n- geom_sf (지리적 객체 그래프)\n  - 경계선 색상\n- coord_sf\n  - 지도 좌표계 제거\n- scale_fill_distiller\n  - 이름 : \"2023년 3월 총인구수\"\n  - 팔레트 색상 설정\n  - 연속형 색상 척도 사용\n  - 결측값 색상 설정\n  - 색상 척도 방향 설정 : 작은 값 → 큰 값\n  - 색상 척도 눈금 설정\n  - 색상 척도 라벨 설정, 천 단위 옵션, 지수표기법 미사용\n- 테마 : 미니멀\n- 테마 옵션\n  - 범례 제목 위치 지정\n  - 범례 텍스트 위치 지정\n  - 범례 위치 지정\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(KOR_SIGU_use, aes(fill = 총인구수_202303)) +\ngeom_sf(color = \"gray90\") +\ncoord_sf(datum = NA) +\nscale_fill_distiller(name = \"2023년 3월 총인구수\",\n                      palette = \"Blues\",\n                      type = \"seq\",\n                      na.value = \"grey60\",\n                      direction = 1,\n                      breaks = seq(0,10,2) * 1e+5,\n                      labels = format(seq(0,10,2) * 1e+5,\n                                      big.mark = \",\", scientific = F),) +\ntheme_minimal() +\ntheme(legend.title.align = 0.5,\n      legend.text.align = 1.0,\n      legend.position = c(.85, .2))\n```\n\n::: {.cell-output-display}\n![](figure-4.4-,--figure-4.6_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "figure-4.4-,--figure-4.6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}