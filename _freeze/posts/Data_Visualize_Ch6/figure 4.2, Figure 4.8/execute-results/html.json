{
  "hash": "582d11755e1c37daa1722a72885c0c9e",
  "result": {
    "markdown": "---\ntitle: \"Data_Visualization CH6\"\nauthor: \"Seongtaek\"\ndate: \"2023-04-12\"\ncategories: [code, data_visualization, rstudio]\nimage: \"ch6.png\"\ntoc: true\ntoc-depth: 3\nnumber-sections: true\n---\n\n\n<table align=\"bottom\">\n  <td>\n    <a target=\"_blank\" href=\"figure 4.2, figure 4.8.html\"><img\n    src = r_logo.png />HTML파일로 보기</a>\n  </td>\n</table>\n\nFigure 4.2, Figure 4.8\n\n\n\n\n\n## 데이터 시각화 실습 : 막대그래프 Figure 4.2, Figure 4.8\n\n### 패키지 불러오기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n#> \n#> Attaching package: 'dplyr'\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\nlibrary(colorspace)\n```\n:::\n\n\n### RColorBrewer의 모든 컬러 맵 보기\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"RColorBrewer\")\nRColorBrewer::display.brewer.all()\n```\n\n::: {.cell-output-display}\n![](figure-4.2,-Figure-4.8_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### 데이터 불러오기, 파악\n- US_cescus.csv  (미국 인구조사 데이터셋)\n- US_regions.csv (미국 지역 분류 정보 데이터셋)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nUS_census <- read.csv('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/US_census.csv')\nUS_regions <- read.csv('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/US_regions.csv')\n\n### 차원 파악\nUS_census %>% dim()\n#> [1] 3143   53\nUS_regions %>% dim()\n#> [1] 51  4\n\n### 앞부분 훑어보기\nUS_census %>% head(2)\n#>     state           name FIPS pop2010 pop2000 age_under_5 age_under_18\n#> 1 Alabama Autauga County 1001   54571   43671         6.6         26.8\n#> 2 Alabama Baldwin County 1003  182265  140415         6.1         23.0\n#>   age_over_65 female white black native asian pac_isl two_plus_races hispanic\n#> 1        12.0   51.3  78.5  17.7    0.4   0.9      NA            1.6      2.4\n#> 2        16.8   51.1  85.7   9.4    0.7   0.7      NA            1.5      4.4\n#>   white_not_hispanic no_move_in_one_plus_year foreign_born\n#> 1               77.2                     86.3          2.0\n#> 2               83.5                     83.0          3.6\n#>   foreign_spoken_at_home hs_grad bachelors veterans mean_work_travel\n#> 1                    3.7    85.3      21.7     5817             25.1\n#> 2                    5.5    87.6      26.8    20396             25.8\n#>   housing_units home_ownership housing_multi_unit median_val_owner_occupied\n#> 1         22135           77.5                7.2                    133900\n#> 2        104061           76.7               22.6                    177200\n#>   households persons_per_household per_capita_income median_household_income\n#> 1      19718                   2.7             24568                   53255\n#> 2      69476                   2.5             26469                   50147\n#>   poverty private_nonfarm_establishments private_nonfarm_employment\n#> 1    10.6                            877                      10628\n#> 2    12.2                           4812                      52233\n#>   percent_change_private_nonfarm_employment nonemployment_establishments firms\n#> 1                                      16.6                         2971  4067\n#> 2                                      17.4                        14175 19035\n#>   black_owned_firms native_owned_firms asian_owned_firms pac_isl_owned_firms\n#> 1              15.2                 NA               1.3                  NA\n#> 2               2.7                0.4               1.0                  NA\n#>   hispanic_owned_firms women_owned_firms manufacturer_shipments_2007\n#> 1                  0.7              31.7                          NA\n#> 2                  1.3              27.3                     1410273\n#>   mercent_whole_sales_2007   sales sales_per_capita accommodation_food_service\n#> 1                       NA  598175            12003                      88157\n#> 2                       NA 2966489            17166                     436955\n#>   building_permits fed_spending    area density\n#> 1              191       331142  594.44    91.8\n#> 2              696      1119082 1589.78   114.6\nUS_regions %>% head()\n#>        state state_abr region           division\n#> 1    Alabama        AL  South East South Central\n#> 2     Alaska        AK   West            Pacific\n#> 3    Arizona        AZ   West           Mountain\n#> 4   Arkansas        AR  South West South Central\n#> 5 California        CA   West            Pacific\n#> 6   Colorado        CO   West           Mountain\n```\n:::\n\n\n### 전처리\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopgrowth_df <- US_census %>%                         \n  left_join(US_regions) %>%                         # US_census 기준으로 left_join\n  group_by(region, division, state) %>%             # 그룹화할 컬럼 선택  \n  summarise(pop2000 = sum(pop2000, na.rm = T),      # 그룹화된 컬럼들의 집계값 설정\n            pop2010 = sum(pop2010, na.rm = T),\n            popgrowth = (pop2010 - pop2000)/pop2000,\n            area = sum(area)) %>%\n  arrange(popgrowth) %>%                            # 해당 컬럼 기준으로 오름차순 정렬\n  ungroup() %>%                                     # 그룹화 해제\n  mutate(state = factor(state, levels=state),       # 팩터로 변환, level 지정 \n         region = factor(region, levels=c('West','South','Midwest','Northeast')))\n#> Joining with `by = join_by(state)`\n#> `summarise()` has grouped output by 'region', 'division'. You can override\n#> using the `.groups` argument.\n\npopgrowth_df\n#> # A tibble: 51 × 7\n#>    region    division           state          pop2000  pop2010 popgrowth   area\n#>    <fct>     <chr>              <fct>            <int>    <int>     <dbl>  <dbl>\n#>  1 Midwest   East North Central Michigan       9938444  9883640  -0.00551 56539.\n#>  2 Northeast New England        Rhode Island   1048319  1052567   0.00405  1034.\n#>  3 South     West South Central Louisiana      4468976  4533372   0.0144  43204.\n#>  4 Midwest   East North Central Ohio          11353140 11536504   0.0162  40861.\n#>  5 Northeast Middle Atlantic    New York      18976457 19378102   0.0212  47126.\n#>  6 South     South Atlantic     West Virginia  1808344  1852994   0.0247  24038.\n#>  7 Northeast New England        Vermont         608827   625741   0.0278   9217.\n#>  8 Northeast New England        Massachusetts  6349097  6547629   0.0313   7800.\n#>  9 Midwest   East North Central Illinois      12419293 12830632   0.0331  55519.\n#> 10 Northeast Middle Atlantic    Pennsylvania  12281054 12702379   0.0343  44743.\n#> # … with 41 more rows\n\n### 4개 지방의 색 지정\nregion_colors <- c('#E69F00','#56B4E9','#009E73','#F0E442')\nregion_colors\n#> [1] \"#E69F00\" \"#56B4E9\" \"#009E73\" \"#F0E442\"\n```\n:::\n\n\n### Figure 4.2\n- 사용 데이터셋 : popgrowth_df\n- x=state, y=100*popgrowth\n- fill : region별\n- geom_col (막대 그래프)\n- scale_y_continuous\n  - 이름 : 'population growth, 2000 to 2010'\n  - 범위 : 0 ~ 0 : 더욱 직관적인 그래프 표현 가능\n  - 라벨 : 백분율 형식\n- scale_fill_manual\n  - fill 옵션 색상 : region_colors\n- coord_flip() : x축, y축 체인지 → 세로방향 긴 막대를 가로방향으로 짧게 표시\n- 테마 : 밝게\n- 테마 옵션\n  - 그래프 패널의 테두리 제거\n  - y축 그리드 제거\n  - y축 레이블 제거\n  - y축 눈금선 제거\n  - y축 폰트 크기 설정\n  - 그래프상의 범례 위치 조정\n  - 범례 배경 색상 설정\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(popgrowth_df, aes(x=state, y=100*popgrowth, fill=region)) +\n  geom_col() +\n  scale_y_continuous(name = 'population growth, 2000 to 2010',\n                     labels = scales::percent_format(scale=1),\n                     expand = c(0,0)) +\n  scale_fill_manual(values = region_colors) +\n  coord_flip() +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        panel.grid.major.y = element_blank(),\n        axis.title.y = element_blank(),\n        axis.ticks.length = unit(0, 'pt'),\n        axis.text.y = element_text(size = 6),\n        legend.position = c(.7, .68),\n        legend.background = element_rect(fill = '#ffffffb0'))\n```\n\n::: {.cell-output-display}\n![](figure-4.2,-Figure-4.8_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## 예제\n- 주민등록 인구 및 세대현황 Figure 4.2\n\n### 데이터 불러오기, 파악\n- 202202_주민등록인구및세대현황.csv\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkor_202202 <- read.csv('C:/Users/seong taek/Desktop/3-1 DataVisualize/data_visualize/202202_주민등록인구및세대현황.csv')\n\n### 앞부분 훑어보기\nkor_202202 %>%  head()\n#>            행정구역 행정구역_코드 총인구수  세대수 세대당_인구 남자_인구수\n#> 1       서울특별시     1100000000  9508451 4442586        2.14     4615823\n#> 2 서울특별시 종로구    1111000000   144575   73763        1.96       70092\n#> 3   서울특별시 중구    1114000000   122167   63644        1.92       59446\n#> 4 서울특별시 용산구    1117000000   222413  111134        2.00      106881\n#> 5 서울특별시 성동구    1120000000   285137  134286        2.12      138866\n#> 6 서울특별시 광진구    1121500000   340494  168975        2.02      164226\n#>   여자_인구수 남여_비율\n#> 1     4892628      0.94\n#> 2       74483      0.94\n#> 3       62721      0.95\n#> 4      115532      0.93\n#> 5      146271      0.95\n#> 6      176268      0.93\n\n### 차원 파악\nkor_202202 %>% dim()\n#> [1] 291   8\n\n### 컬럼 클래스(타입) 확인\nkor_202202 %>% sapply(class)\n#>      행정구역 행정구역_코드      총인구수        세대수   세대당_인구 \n#>   \"character\"     \"numeric\"     \"numeric\"     \"numeric\"     \"numeric\" \n#>   남자_인구수   여자_인구수     남여_비율 \n#>     \"numeric\"     \"numeric\"     \"numeric\"\n\n### `행정구역_코드`를 numeric → character형식으로 변환\nkor_202202$행정구역_코드 <- kor_202202$행정구역_코드 %>% format()\n```\n:::\n\n### 전처리\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 행정구역 컬럼의 1,2번째 자리의 값을 지정해서 추출\n# 행정구역_코드 컬럼의 3,4번째 자리의 값이 0이 아닌것만 추출\n# 해당 열만 선택\n# 해당 열 기준으로 오름차순 정렬\nkor_202202_use <- kor_202202 %>% \n  filter(substr(행정구역,1,2) %in% c('서울','대전','대구','부산')) %>% \n  filter(substr(행정구역_코드,3,4) != '00') %>%                        \n  select(행정구역, 총인구수) %>%                                        \n  arrange(총인구수)                                                    \n\nkor_202202_use %>% head()\n#>            행정구역 총인구수\n#> 1   부산광역시 중구    40582\n#> 2   대구광역시 중구    74710\n#> 3   부산광역시 동구    88245\n#> 4   부산광역시 서구   104618\n#> 5 부산광역시 영도구   109991\n#> 6   서울특별시 중구   122167\n\n### '시도' 컬럼 생성\nkor_202202_use$시도 <- sapply(kor_202202_use$행정구역,\n                            function(x) strsplit(x, \" \")[[1]][1])\n\nkor_202202_use %>% head()\n#>            행정구역 총인구수       시도\n#> 1   부산광역시 중구    40582 부산광역시\n#> 2   대구광역시 중구    74710 대구광역시\n#> 3   부산광역시 동구    88245 부산광역시\n#> 4   부산광역시 서구   104618 부산광역시\n#> 5 부산광역시 영도구   109991 부산광역시\n#> 6   서울특별시 중구   122167 서울특별시\n\nkor_202202_use %>% sapply(class)\n#>    행정구역    총인구수        시도 \n#> \"character\"   \"numeric\" \"character\"\n\n# factor 변환, level 지정\nkor_202202_use$시도 <- factor(kor_202202_use$시도,\n                            levels = c(\"서울특별시\",\n                                       \"대전광역시\",\n                                       \"대구광역시\",\n                                       \"부산광역시\"))\n\nkor_202202_use$시도 %>% head()\n#> [1] 부산광역시 대구광역시 부산광역시 부산광역시 부산광역시 서울특별시\n#> Levels: 서울특별시 대전광역시 대구광역시 부산광역시\n\nkor_202202_use$시도 %>% summary()\n#> 서울특별시 대전광역시 대구광역시 부산광역시 \n#>         25          5          8         16\n\n### 4개 지방의 색 지정\nregion_colors <- RColorBrewer::brewer.pal(4, \"Set2\")\n```\n:::\n\n\n### Figure 4.2\n- 사용 데이터셋 : kor_202202_use\n- x=reorder(행정구역, 총인구수) : '총인구수' 기준으로 '행정구역' 정렬,\n  y=총인구수\n- fill : 시도별\n- geom_col (막대 그래프)\n- scale_y_continuous\n  - 이름 : '총인구수, 2022년 2월'\n  - 범위 : 0 ~ 0 : 더욱 직관적인 그래프 표현 가능\n  - 라벨 : 천 단위 구분 기호 사용\n- scale_fill_manual\n  - fill 옵션 색상 : region_colors\n- coord_flip() : x축, y축 체인지 → 세로방향 긴 막대를 가로방향으로 짧게 표시\n- 테마 : 밝게\n- 테마 옵션\n  - 그래프 패널의 테두리 제거\n  - y축 그리드 제거\n  - y축 레이블 제거\n  - y축 눈금선 제거\n  - y축 폰트 크기 설정\n  - 그래프상의 범례 위치 조정\n  - 범례 배경 색상 설정\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(kor_202202_use, aes(x=reorder(행정구역, 총인구수), y=총인구수, fill=시도)) +\n  geom_col() +\n  scale_y_continuous(name = '총인구수, 2022년 2월',\n                     labels = scales::comma,\n                     expand = c(0,0)) +\n  scale_fill_manual(values = region_colors) +\n  coord_flip() +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        panel.grid.major.y = element_blank(),\n        axis.title.y = element_blank(),\n        axis.ticks.length = unit(0, 'pt'),\n        axis.text.y = element_text(size = 5),\n        legend.position = c(.78, .28),\n        legend.background = element_rect(fill = '#ffffffb0'))\n```\n\n::: {.cell-output-display}\n![](figure-4.2,-Figure-4.8_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Figure 4.8\n\n### 전처리\n\n::: {.cell}\n\n```{.r .cell-code}\n### 4개 지방의 색 지정 + 밝기조정 + 채도조정 \nregion_colors <- c('#E69F00','#56B4E9','#009E73','#F0E442') %>% lighten(0.4) %>% desaturate(0.8)\n\nregion_colors\n#> [1] \"#D9CBBE\" \"#C3CDD6\" \"#AABCB3\" \"#F0EDD6\"\n\n### 컬럼 추가 (region_highlight - NA)\npopgrowth_df <- popgrowth_df %>% \n  mutate(region_highlight = ifelse(state %in% c('Texas', 'Louisiana'),\n                                   NA, region %>% paste()))\n\npopgrowth_df %>% head()\n#> # A tibble: 6 × 8\n#>   region    division           state     pop2000 pop2010 popgro…¹   area regio…²\n#>   <fct>     <chr>              <fct>       <int>   <int>    <dbl>  <dbl> <chr>  \n#> 1 Midwest   East North Central Michigan   9.94e6  9.88e6 -0.00551 56539. Midwest\n#> 2 Northeast New England        Rhode Is…  1.05e6  1.05e6  0.00405  1034. Northe…\n#> 3 South     West South Central Louisiana  4.47e6  4.53e6  0.0144  43204. <NA>   \n#> 4 Midwest   East North Central Ohio       1.14e7  1.15e7  0.0162  40861. Midwest\n#> 5 Northeast Middle Atlantic    New York   1.90e7  1.94e7  0.0212  47126. Northe…\n#> 6 South     South Atlantic     West Vir…  1.81e6  1.85e6  0.0247  24038. South  \n#> # … with abbreviated variable names ¹​popgrowth, ²​region_highlight\n```\n:::\n\n\n### Figure 4.8\n- 사용 데이터셋 : popgrowth_df\n- x=state, y=100*popgrowth\n- fill : region_highlight별\n- geom_col (막대 그래프)\n- scale_y_continuous\n  - 이름 : 'population growth, 2000 to 2010'\n  - 범위 : 0 ~ 0 : 더욱 직관적인 그래프 표현 가능\n  - 라벨 : 백분율 형식\n- scale_fill_manual\n  - fill 옵션 색상 : region_colors\n  - 그래프상 범례 레이블 지정\n  - NA 값일 때 색상 지정\n- coord_flip() : x축, y축 체인지 → 세로방향 긴 막대를 가로방향으로 짧게 표시\n- 테마 : 밝게\n- 테마 옵션\n  - 그래프 패널의 테두리 제거\n  - y축 그리드 제거\n  - y축 레이블 제거\n  - y축 눈금선 제거\n  - y축 폰트 크기 설정\n  - 그래프상의 범례 위치 조정\n  - 범례 배경 색상 설정\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(popgrowth_df, aes(x=state, y=100*popgrowth, fill=region_highlight)) +\n  geom_col() +\n  scale_y_continuous(name = 'population growth, 2000 to 2010',\n                     labels = scales::percent_format(scale=1),\n                     expand = c(0,0)) +\n  scale_fill_manual(values = region_colors,\n                    breaks = c(\"West\", \"South\", \"Midwest\", \"Northeast\"),\n                    na.value = \"#56B4E9\" %>% darken(0.3)) +\n  coord_flip() +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        panel.grid.major.y = element_blank(),\n        axis.title.y = element_blank(),\n        axis.ticks.length = unit(0, 'pt'),\n        axis.text.y = element_text(size = 5),\n        legend.position = c(.58, .58),\n        legend.background = element_rect(fill = '#ffffffb0')) # color =테두리색\n```\n\n::: {.cell-output-display}\n![](figure-4.2,-Figure-4.8_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## 예제2\n-대전광역시 강조하기 Figure 4.8\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### 컬러 지정시 대전 따로 지정\nregion_colors <- c('#E69F00','#56B4E9','#009E73','#F0E442') %>% lighten(0.4) %>% desaturate(0.8)\n\nregion_colors[2] <- \"#56B4E9\" %>% darken(0.3)\n\nregion_colors \n#> [1] \"#D9CBBE\" \"#077DAA\" \"#AABCB3\" \"#F0EDD6\"\n\nggplot(kor_202202_use, aes(x=reorder(행정구역, 총인구수), y=총인구수, fill=시도)) +\n  geom_col() +\n  scale_y_continuous(name = '총인구수, 2022년 2월',\n                     labels = scales::comma,\n                     expand = c(0,0)) +\n  scale_fill_manual(values = region_colors) +\n  coord_flip() +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        panel.grid.major.y = element_blank(),\n        axis.title.y = element_blank(),\n        axis.ticks.length = unit(0, 'pt'),\n        axis.text.y = element_text(size = 5),\n        legend.position = c(.78, .28),\n        legend.background = element_rect(fill = '#ffffffb0'))\n```\n\n::: {.cell-output-display}\n![](figure-4.2,-Figure-4.8_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "figure-4.2,-Figure-4.8_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}