{
  "hash": "6d1f195856990d2f549f64dc6711cf5f",
  "result": {
    "markdown": "---\ntitle: \"Opendata_Analysis CH4\"\nauthor: \"Seongtaek\"\ndate: \"2023-04-16\"\ncategories: [code, opendata_analysis, rstudio]\nimage: \"td.png\"\ntoc: true\ntoc-depth: 4\nnumber-sections: true\n---\n\n\n<table align=\"bottom\">\n  <td>\n    <a target=\"_blank\" href=\"data_tyding_ht.html\"><img\n    src = r_logo.png />HTML파일로 보기</a>\n  </td>\n</table>\n\nData Tyding\n\n## 오픈데이터 분석 실습 : Data Tyding\n\n### 패키지 불러오기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\n```\n:::\n\n\n### Tidy data\n- 원칙\n  - 각 변수는 각각의 열을 가져야한다\n  - 각 변수는 각각의 행을 가져야한다\n  - 각 셀은 하나의 값을 가져야한다\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### 확진자수 데이터셋\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n:::\n\n```{.r .cell-code}\n### rate 컬럼 생성\ntable1 %>% \n  mutate(rate = cases/population*10000)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  country      year  cases population  rate\n  <chr>       <dbl>  <dbl>      <dbl> <dbl>\n1 Afghanistan  1999    745   19987071 0.373\n2 Afghanistan  2000   2666   20595360 1.29 \n3 Brazil       1999  37737  172006362 2.19 \n4 Brazil       2000  80488  174504898 4.61 \n5 China        1999 212258 1272915272 1.67 \n6 China        2000 213766 1280428583 1.67 \n```\n:::\n\n```{.r .cell-code}\n### 연도별 cases(확진자) 수\ntable1 %>% \n  count(year, wt=cases) # wt=weight=가중치\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n   year      n\n  <dbl>  <dbl>\n1  1999 250740\n2  2000 296920\n```\n:::\n\n```{.r .cell-code}\n### 국가별 확진자 수 추이\nggplot(table1, aes(x=year, y=cases)) +\n  geom_line(aes(group = country), colour = \"grey50\") + # 국가별 선 구분, 색상 통일\n  geom_point(aes(colour = country, shape = country)) + # 국가별 점 색상/모양 구분\n  scale_x_continuous(breaks = c(1999,2000)) +          # x축 눈금 지정\n  facet_wrap(vars(country), scales = \"free\")           # 국가별 패널 구분, 눈금-독립조정\n```\n\n::: {.cell-output-display}\n![](data_tyding_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n### 2000년도 국가별 ratio \ndata<- table1 %>% \n  group_by(country) %>% \n  mutate(ratio = cases/min(cases)) %>%  # ratio = 확진자 수 최소 정규화\n  filter(year==2000)\n\ndata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 5\n# Groups:   country [3]\n  country      year  cases population ratio\n  <chr>       <dbl>  <dbl>      <dbl> <dbl>\n1 Afghanistan  2000   2666   20595360  3.58\n2 Brazil       2000  80488  174504898  2.13\n3 China        2000 213766 1280428583  1.01\n```\n:::\n\n```{.r .cell-code}\n### 국가별 2000년도 확진자 수 최소 정규화\nggplot(data, aes(x = country, y = ratio, fill = country)) + # 색상:국가별\n  geom_bar(stat = \"identity\", width = 0.5) +                # 막대너비 지정\n  labs(title = \"Ratio by Country\",\n       x = \"Country\", y = \"Ratio\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")                           # 범례 미지정\n```\n\n::: {.cell-output-display}\n![](data_tyding_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\n### 1999 - 2000 증가량 계산\ndata <- table1\n\ndata<- table1 %>% \n  group_by(country) %>%  \n  mutate(increase = cases - cases[year == 1999])  \n\ndata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n# Groups:   country [3]\n  country      year  cases population increase\n  <chr>       <dbl>  <dbl>      <dbl>    <dbl>\n1 Afghanistan  1999    745   19987071        0\n2 Afghanistan  2000   2666   20595360     1921\n3 Brazil       1999  37737  172006362        0\n4 Brazil       2000  80488  174504898    42751\n5 China        1999 212258 1272915272        0\n6 China        2000 213766 1280428583     1508\n```\n:::\n\n```{.r .cell-code}\n### 국가별 확진자 수 증가량 추이\nggplot(data %>% filter(year==2000), \n       aes(x = country, y = increase, fill = country)) + \n  geom_bar(stat = \"identity\", width = 0.5) +\n  labs(title = \"Cases Increase from 1999 to 2000 by Country\",\n       x = \"Country\", y = \"Cases Increase\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](data_tyding_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n:::\n\n\n## Pivoting\n\n### pivot_longer\n- 데이터를 긴 형태에서 넓은 형태로 변환\n- 여러 컬럼을 하나의 컬럼으로 정리\n- 주로 정규화 작업을 수행\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### 국가/연도별 확진자 수\ntable4a\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 3\n  country     `1999` `2000`\n  <chr>        <dbl>  <dbl>\n1 Afghanistan    745   2666\n2 Brazil       37737  80488\n3 China       212258 213766\n```\n:::\n\n```{.r .cell-code}\n### pivot_longer\ntable4a_pivot_longer <- table4a %>%\n  pivot_longer(\n    cols = c(`1999`, `2000`),        # 변환할 컬럼 지정\n    names_to = \"year\",               # 변환될 컬럼 이름 지정\n    values_to = \"cases\"              # 변환된 값들이 저장될 컬럼 이름 지정\n    ) %>%\n  mutate(year = parse_integer(year)) # 정수형 타입 변환\n\ntable4a_pivot_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  country      year  cases\n  <chr>       <int>  <dbl>\n1 Afghanistan  1999    745\n2 Afghanistan  2000   2666\n3 Brazil       1999  37737\n4 Brazil       2000  80488\n5 China        1999 212258\n6 China        2000 213766\n```\n:::\n\n```{.r .cell-code}\n### ggplot 그래프\ntable4a_pivot_longer %>%\n  ggplot(aes(x = year, y = cases)) +\n  geom_line(aes(group = country), colour = \"grey50\") +\n  geom_point(aes(colour = country, shape = country)) +\n  scale_x_continuous(breaks = c(1999, 2000))\n```\n\n::: {.cell-output-display}\n![](data_tyding_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### pivot_longer + left_join\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### 국가/연도별 인구수\ntable4b\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 3\n  country         `1999`     `2000`\n  <chr>            <dbl>      <dbl>\n1 Afghanistan   19987071   20595360\n2 Brazil       172006362  174504898\n3 China       1272915272 1280428583\n```\n:::\n\n```{.r .cell-code}\n### pivot_longer\ntable4b_pivot_longer <- table4b %>%\n  pivot_longer(\n    cols = c(`1999`, `2000`),\n    names_to = \"year\",\n    values_to = \"population\"\n  ) %>%\n  mutate(year = parse_integer(year))\n\ntable4b_pivot_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  country      year population\n  <chr>       <int>      <dbl>\n1 Afghanistan  1999   19987071\n2 Afghanistan  2000   20595360\n3 Brazil       1999  172006362\n4 Brazil       2000  174504898\n5 China        1999 1272915272\n6 China        2000 1280428583\n```\n:::\n\n```{.r .cell-code}\n### 확진자 수 + 인구수 left_join\ntable4a_pivot_longer %>% left_join(table4b_pivot_longer, by = c(\"country\", \"year\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <int>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n:::\n:::\n\n\n### pivot_wider\n- 데이터를 넓은 형태에서 긴 형태로 변환\n- 하나의 컬럼을 여러개 컬럼으로 확장\n- 주로 비정규화 작업을 수행\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 4\n   country      year type            count\n   <chr>       <dbl> <chr>           <dbl>\n 1 Afghanistan  1999 cases             745\n 2 Afghanistan  1999 population   19987071\n 3 Afghanistan  2000 cases            2666\n 4 Afghanistan  2000 population   20595360\n 5 Brazil       1999 cases           37737\n 6 Brazil       1999 population  172006362\n 7 Brazil       2000 cases           80488\n 8 Brazil       2000 population  174504898\n 9 China        1999 cases          212258\n10 China        1999 population 1272915272\n11 China        2000 cases          213766\n12 China        2000 population 1280428583\n```\n:::\n\n```{.r .cell-code}\n### pivot_wider\ntable2_pivot_wider <- table2 %>%\n  pivot_wider(names_from = type,       # 여러 컬럼으로 확장할 컬럼 지정\n              values_from = count) %>% # 확장할 컬럼에 해당하는 값\n  mutate(rate = cases / population)\n\ntable2_pivot_wider\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  country      year  cases population      rate\n  <chr>       <dbl>  <dbl>      <dbl>     <dbl>\n1 Afghanistan  1999    745   19987071 0.0000373\n2 Afghanistan  2000   2666   20595360 0.000129 \n3 Brazil       1999  37737  172006362 0.000219 \n4 Brazil       2000  80488  174504898 0.000461 \n5 China        1999 212258 1272915272 0.000167 \n6 China        2000 213766 1280428583 0.000167 \n```\n:::\n\n```{.r .cell-code}\n### ggplot 그래프\ntable2_pivot_wider %>% ggplot(aes(x = year, y = rate)) +\n  geom_line(aes(group = country), colour = \"grey50\") +\n  geom_point(aes(colour = country, shape = country)) +\n  scale_x_continuous(breaks = c(1999, 2000))\n```\n\n::: {.cell-output-display}\n![](data_tyding_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Advanced Pivoting (Missing values)\n\n### NA값이 있을 때의 `pivot_longer`\n\n::: {.cell}\n\n```{.r .cell-code}\n#remotes::install_github(\"dcl-docs/dcldata\")\nlibrary(dcldata)\n\nexample_migration\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 6\n  dest     Afghanistan Canada India Japan `South Africa`\n  <chr>    <chr>       <chr>  <chr> <chr> <chr>         \n1 Albania  <NA>        913    <NA>  <NA>  <NA>          \n2 Bulgaria 483         713    281   213   260           \n3 Romania  <NA>        <NA>   102   <NA>  <NA>          \n```\n:::\n\n```{.r .cell-code}\n### drop_na로 제거\nexample_migration %>% \n  pivot_longer(cols = !dest, \n               names_to = \"origin\", \n               values_to = \"migrants\") %>% \n  drop_na(migrants)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 3\n  dest     origin       migrants\n  <chr>    <chr>        <chr>   \n1 Albania  Canada       913     \n2 Bulgaria Afghanistan  483     \n3 Bulgaria Canada       713     \n4 Bulgaria India        281     \n5 Bulgaria Japan        213     \n6 Bulgaria South Africa 260     \n7 Romania  India        102     \n```\n:::\n:::\n",
    "supporting": [
      "data_tyding_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}